<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Saih Store - Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±">
    <title>Saih Store</title>

    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1910150606256826');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1910150606256826&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Dark Premium Theme Optimized --- */
        :root { 
            --primary-color: #3b82f6; 
            --primary-dark: #2563eb;
            --danger-color: #ef4444;
            --success-color: #10b981;
            --gold-color: #fbbf24;
            
            --bg-color: #000000;
            --card-bg: #18181b; 
            --input-bg: #27272a;
            
            --text-main: #ffffff;
            --text-sub: #a1a1aa;
            --border-color: #3f3f46;
            
            --radius-md: 12px;
            --radius-lg: 16px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Cairo', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            direction: rtl; 
            text-align: right; 
            padding-bottom: 90px; /* Space for bottom nav */
            overflow-x: hidden; 
        }
        body[dir="ltr"] { font-family: 'Poppins', sans-serif; direction: ltr; text-align: left; }

        a { text-decoration: none; color: inherit; }
        img { display: block; max-width: 100%; }
        button { border: none; font-family: inherit; }

        /* --- Header --- */
        header { 
            background: rgba(24, 24, 27, 0.95); 
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            position: sticky; top: 0; z-index: 1000; 
            height: 60px;
        }
        .header-container { display: flex; justify-content: space-between; align-items: center; padding: 0 15px; height: 100%; max-width: 1200px; margin: 0 auto; }
        .logo img { height: 40px; object-fit: contain; }
        
        .header-icons { display: flex; gap: 15px; align-items: center; }
        .icon-btn { font-size: 22px; cursor: pointer; position: relative; color: var(--text-main); padding: 5px; }
        .cart-badge { 
            position: absolute; top: 0; right: 0; 
            background-color: var(--danger-color); color: white; 
            font-size: 10px; min-width: 18px; height: 18px; 
            border-radius: 9px; display: flex; justify-content: center; align-items: center; font-weight: bold; border: 2px solid var(--card-bg);
        }
        
        /* --- Hero Slider --- */
        .hero-slider { margin-bottom: 25px; position: relative; height: 220px; width: 100%; overflow: hidden; }
        .hero-slider::after { content:''; position: absolute; bottom:0; left:0; width:100%; height:50%; background: linear-gradient(to top, var(--bg-color), transparent); z-index: 1; }
        .hero-slider img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.7); }
        .hero-text { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); text-align: center; width: 90%; z-index: 2; }
        .hero-text h1 { font-size: 24px; font-weight: 900; color: white; margin-bottom: 5px; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }
        .hero-text p { font-size: 13px; font-weight: 600; color: #e4e4e7; }

        .section-title { padding: 0 20px; margin: 30px 0 20px; font-size: 20px; font-weight: 800; color: var(--text-main); display: flex; align-items: center; gap: 10px; }
        .section-title::before { content: ""; display: block; width: 4px; height: 24px; background: var(--primary-color); border-radius: 2px; }
        
        /* --- Product Grid --- */
        .products-grid { 
            display: grid; 
            grid-template-columns: 1fr; /* Single column on very small phones */
            gap: 20px; 
            padding: 0 15px; 
            max-width: 800px; 
            margin: 0 auto; 
        }
        /* Mobile Large + Tablet */
        @media (min-width: 480px) {
            .products-grid { grid-template-columns: 1fr 1fr; }
        }

        /* --- Product Card & Native Slider --- */
        .product-card { 
            background: var(--card-bg); 
            border-radius: var(--radius-md); 
            overflow: hidden; 
            border: 1px solid var(--border-color);
            position: relative;
        }

        /* Native Scroll Snap Slider */
        .slider-wrapper { position: relative; width: 100%; aspect-ratio: 1/1; background: #fff; }
        .slider-container {
            display: flex;
            width: 100%; height: 100%;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch; /* Smooth scroll on iOS */
            scrollbar-width: none; /* Firefox */
        }
        .slider-container::-webkit-scrollbar { display: none; } /* Chrome/Safari */
        
        .slider-slide {
            flex: 0 0 100%;
            width: 100%; height: 100%;
            scroll-snap-align: center;
            position: relative;
        }
        .product-img { 
            width: 100%; height: 100%; 
            object-fit: contain; 
            padding: 10px;
        }

        /* Dots Indicator */
        .slider-dots {
            position: absolute; bottom: 10px; left: 0; width: 100%;
            display: flex; justify-content: center; gap: 6px; z-index: 5;
            pointer-events: none;
        }
        .dot {
            width: 6px; height: 6px; background: rgba(0,0,0,0.2); border-radius: 50%;
            transition: 0.3s;
        }
        .dot.active { background: var(--primary-color); transform: scale(1.3); }

        .discount-tag { 
            position: absolute; top: 10px; right: 10px; 
            background: var(--danger-color); color: white; 
            padding: 4px 8px; border-radius: 6px; 
            font-size: 11px; font-weight: bold; z-index: 5; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        body[dir="ltr"] .discount-tag { right: auto; left: 10px; }

        .product-details { padding: 15px; }
        .product-title { font-size: 15px; font-weight: 700; margin-bottom: 8px; line-height: 1.4; color: var(--text-main); }
        .price-box { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; }
        .curr-price { color: var(--primary-color); font-weight: 900; font-size: 18px; }
        .old-price { text-decoration: line-through; color: var(--text-sub); font-size: 13px; }
        
        /* Direct Form */
        .direct-form { display: flex; flex-direction: column; gap: 8px; }
        .direct-input { 
            width: 100%; padding: 12px; 
            background: var(--input-bg); 
            border: 1px solid var(--border-color); 
            color: white; border-radius: 8px; 
            font-size: 14px; 
            transition: 0.2s;
        }
        .direct-input:focus { border-color: var(--primary-color); background: #303035; }
        
        .action-row { display: flex; gap: 8px; margin-top: 5px; }
        .confirm-btn { 
            flex: 2; padding: 12px; 
            background: var(--text-main); color: var(--bg-color); 
            border-radius: 8px; font-weight: 800; font-size: 14px; 
            cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 5px;
        }
        .add-cart-btn {
            flex: 1; padding: 12px;
            background: transparent; color: var(--text-main);
            border: 1px solid var(--border-color);
            border-radius: 8px; cursor: pointer; font-size: 18px;
        }
        .add-cart-btn:active { background: var(--input-bg); }

        /* --- Skeleton Loading --- */
        .skeleton { background: #27272a; animation: shimmer 1.5s infinite linear; background-size: 200% 100%; background-image: linear-gradient(to right, #27272a 0%, #3f3f46 20%, #27272a 40%, #27272a 100%); }
        @keyframes shimmer { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }
        .sk-card { height: 450px; border-radius: var(--radius-md); background: var(--card-bg); margin-bottom: 20px; }

        /* --- Mobile Bottom Nav --- */
        .mobile-bottom-nav { 
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: rgba(24, 24, 27, 0.95); backdrop-filter: blur(10px);
            box-shadow: 0 -1px 0 rgba(255,255,255,0.1); 
            z-index: 1500; display: flex; justify-content: space-around; 
            padding: 10px 0 15px; 
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 10px; color: var(--text-sub); cursor: pointer; gap: 5px; width: 25%; }
        .nav-item i { font-size: 20px; margin-bottom: 2px; }
        .nav-item.active { color: var(--primary-color); font-weight: bold; }
        
        /* Floating WhatsApp */
        .whatsapp-float { 
            position: fixed; bottom: 85px; right: 20px; 
            background: #25d366; color: white; 
            width: 55px; height: 55px; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; 
            font-size: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.4); 
            z-index: 1400; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }
        body[dir="ltr"] .whatsapp-float { right: 20px; left: auto; }
        body[dir="rtl"] .whatsapp-float { right: auto; left: 20px; }

        /* --- Language Splash --- */
        .lang-splash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.4s;
        }
        .lang-box { width: 85%; max-width: 320px; }
        .lang-btn {
            width: 100%; padding: 16px; margin-bottom: 12px;
            border: 1px solid var(--border-color); border-radius: var(--radius-md);
            background: var(--card-bg); color: var(--text-main);
            font-size: 16px; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        /* --- Modal Generic --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; justify-content: center; align-items: flex-end; backdrop-filter: blur(5px); }
        .modal-content { 
            background: var(--card-bg); width: 100%; max-width: 500px; 
            padding: 25px 20px 30px; border-radius: 25px 25px 0 0; 
            position: relative; animation: slideUp 0.3s ease; 
            max-height: 85vh; overflow-y: auto; border-top: 1px solid var(--border-color);
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .modal-header h3 { font-size: 18px; font-weight: 800; color: var(--text-main); margin-bottom: 5px; }
        .modal-header p { font-size: 13px; color: var(--text-sub); margin-bottom: 20px; }
        
        .cart-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; background: var(--input-bg); padding: 10px; border-radius: 10px; }
        .cart-item img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
        .submit-btn { width: 100%; padding: 16px; background: var(--success-color); color: white; border-radius: 12px; font-weight: 800; font-size: 16px; margin-top: 15px; cursor: pointer; }

        /* Image Zoom */
        .zoom-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; flex-direction: column; justify-content: center; }
        .zoom-img { width: 100%; max-height: 80vh; object-fit: contain; }
        .zoom-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; padding: 10px; z-index: 5001; }

    </style>
</head>
<body>

    <!-- Language Selector -->
    <div class="lang-splash" id="langSplash" style="display:none;">
        <div class="lang-box">
            <img src="https://i.postimg.cc/g0ybBZ6t/IMG-20251126-205405-472.jpg" alt="Logo" style="height:80px; margin:0 auto 30px;">
            <button class="lang-btn" onclick="selectLanguage('ar')"><span>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span><img src="https://flagcdn.com/w40/ma.png" alt="AR" width="25"></button>
            <button class="lang-btn" onclick="selectLanguage('en')"><span>English</span><img src="https://flagcdn.com/w40/us.png" alt="EN" width="25"></button>
        </div>
    </div>

    <!-- Zoom Modal -->
    <div class="zoom-overlay" id="zoomModal" onclick="closeZoom()">
        <div class="zoom-close">&times;</div>
        <img src="" id="zoomedImage" class="zoom-img">
    </div>

    <header>
        <div class="header-container">
            <div class="logo"><img src="https://i.postimg.cc/g0ybBZ6t/IMG-20251126-205405-472.jpg" alt="Logo"></div>
            <div class="header-icons">
                <div class="icon-btn" onclick="openCart()">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="cart-badge" id="cartBadge">0</span>
                </div>
            </div>
        </div>
    </header>

    <div class="hero-slider">
        <img src="https://i.postimg.cc/sxbF5Y14/Screenshot-2025-11-19-22-14-44-58-40deb401b9ffe8e1df2f1cc5ba480b12.jpg" alt="Hero">
        <div class="hero-text">
            <h1 data-i18n="hero_title">Saih Store</h1>
            <p data-i18n="hero_sub">Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ù…ØªØ§Ø²Ø© Ø¨Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</p>
        </div>
    </div>

    <div id="products">
        <div class="section-title" data-i18n="featured_offers">Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù…ÙŠØ²Ø©</div>
        <div class="products-grid" id="products-container">
            <!-- Skeleton Loading -->
            <div class="skeleton sk-card"></div>
            <div class="skeleton sk-card"></div>
            <div class="skeleton sk-card"></div>
            <div class="skeleton sk-card"></div>
        </div>
    </div>

    <!-- Mobile Bottom Nav -->
    <div class="mobile-bottom-nav">
        <div class="nav-item active" onclick="window.scrollTo({top:0, behavior:'smooth'})">
            <i class="fas fa-home"></i> <span data-i18n="home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </div>
        <div class="nav-item" onclick="openCart()">
            <i class="fas fa-shopping-cart"></i> <span data-i18n="cart">Ø§Ù„Ø³Ù„Ø©</span>
        </div>
        <div class="nav-item" onclick="fbq('track', 'Contact'); smartWhatsAppLink(MY_PHONE, '')">
            <i class="fab fa-whatsapp"></i> <span data-i18n="whatsapp">ØªÙˆØ§ØµÙ„</span>
        </div>
    </div>

    <div onclick="fbq('track', 'Contact'); smartWhatsAppLink(MY_PHONE, '')" class="whatsapp-float"><i class="fab fa-whatsapp"></i></div>

    <!-- Cart Modal -->
    <div class="modal-overlay" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 data-i18n="cart_title">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
                    <i class="fas fa-times" onclick="closeCart()" style="padding:10px; cursor:pointer"></i>
                </div>
                <p data-i18n="review_order">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯</p>
            </div>
            <div class="cart-items-container" id="cartItemsList"></div>
            <div style="border-top:1px solid var(--border-color); padding-top:15px; margin-top:10px; display:flex; justify-content:space-between; font-weight:bold; font-size:16px;">
                <span data-i18n="total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                <span style="color:var(--success-color)"><span id="cartTotal">0</span> <span data-i18n="currency">Ø¯.Ù…</span></span>
            </div>
            <button class="submit-btn" onclick="openCartOrderForm()"><span data-i18n="complete_order">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</span> <i class="fas fa-arrow-left"></i></button>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="cartOrderModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 data-i18n="delivery_info">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
                    <i class="fas fa-times" onclick="document.getElementById('cartOrderModal').style.display='none'" style="padding:10px; cursor:pointer"></i>
                </div>
                <p data-i18n="enter_details">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</p>
            </div>
            <form onsubmit="submitCartOrder(event)" style="display:flex; flex-direction:column; gap:12px;">
                <input type="text" id="c_name" class="direct-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ / Full Name" required>
                <input type="tel" inputmode="numeric" id="c_phone" class="direct-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ / Phone" required>
                <input type="text" id="c_city" class="direct-input" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© / City" required>
                <input type="text" id="c_address" class="direct-input" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† / Address" required>
                <textarea id="c_notes" class="direct-input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ù„Ù„ÙˆÙ†/Ø§Ù„Ù…Ù‚Ø§Ø³)" style="height:60px"></textarea>
                <button type="submit" class="submit-btn" style="background:#25d366"><span data-i18n="confirm_whatsapp">ØªØ£ÙƒÙŠØ¯ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span> <i class="fab fa-whatsapp"></i></button>
            </form>
        </div>
    </div>

    <script>
        const MY_PHONE = "212695050162"; 
        const SHEET_ID = "1RmpZOJkkQTvYLPXNUxBxHkuNcqoiFn1z5Y0ZbQyx3vk";

        const translations = {
            ar: {
                home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", products: "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", cart: "Ø§Ù„Ø³Ù„Ø©", whatsapp: "ÙˆØ§ØªØ³Ø§Ø¨",
                featured_offers: "Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù…ÙŠØ²Ø©",
                hero_title: "Saih Store", hero_sub: "Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ù…ØªØ§Ø²Ø© Ø¨Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±",
                cart_title: "Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª", review_order: "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", empty_cart: "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹",
                total: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:", currency: "Ø¯.Ù…", complete_order: "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨",
                delivery_info: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„", enter_details: "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„ØªÙˆØµÙŠÙ„",
                confirm_whatsapp: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",
                send_order: "Ø§Ø¶ØºØ· Ù„Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†",
                plh_name: "Ø§Ù„Ø§Ø³Ù…", plh_phone: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ", plh_city: "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©", plh_size: "Ø§Ù„Ù…Ù‚Ø§Ø³/Ø§Ù„Ù„ÙˆÙ†",
                add_to_cart_text: "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©",
                msg_hello: "Ù…Ø±Ø­Ø¨Ø§Ù‹", msg_order_cart: "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (Ø³Ù„Ø©)", msg_order_single: "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (Ù…Ø¨Ø§Ø´Ø±)",
                msg_products: "Ø§Ù„Ù…Ù†ØªØ¬", msg_total: "Ø§Ù„Ù…Ø¨Ù„Øº", msg_customer: "Ø§Ù„Ø²Ø¨ÙˆÙ†",
                msg_confirm: "ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨"
            },
            en: {
                home: "Home", products: "Shop", cart: "Cart", whatsapp: "Chat",
                featured_offers: "Featured Deals",
                hero_title: "Saih Store", hero_sub: "Premium Quality, Best Prices",
                cart_title: "Shopping Cart", review_order: "Review your items", empty_cart: "Your cart is empty",
                total: "Total:", currency: "DH", complete_order: "Checkout",
                delivery_info: "Shipping Info", enter_details: "Enter details for delivery",
                confirm_whatsapp: "Order via WhatsApp",
                send_order: "Order Now",
                plh_name: "Name", plh_phone: "Phone", plh_city: "City", plh_size: "Size/Color",
                add_to_cart_text: "Add",
                msg_hello: "Hello", msg_order_cart: "New Order (Cart)", msg_order_single: "New Order (Direct)",
                msg_products: "Product", msg_total: "Total", msg_customer: "Customer",
                msg_confirm: "Confirm Order"
            }
        };

        let currentLang = localStorage.getItem('lang');
        const productImages = {};

        // Init
        if (!currentLang) {
            document.getElementById('langSplash').style.display = 'flex';
        } else {
            applyLanguage(currentLang);
            fetchProducts();
        }

        function selectLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            applyLanguage(lang);
            document.getElementById('langSplash').style.opacity = '0';
            setTimeout(() => { document.getElementById('langSplash').style.display = 'none'; }, 400);
            fetchProducts();
        }

        function applyLanguage(lang) {
            const t = translations[lang];
            document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(t[key]) el.innerText = t[key];
            });
            // Re-render placeholders
            const inputs = document.querySelectorAll('.direct-input');
            if(inputs.length > 0) fetchProducts(); // quick re-render to fix placeholders
        }

        async function fetchProducts() {
            try {
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
                const res = await fetch(url);
                const text = await res.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                
                const container = document.getElementById('products-container');
                container.innerHTML = ""; // Clear skeletons

                if (json.table.rows.length === 0) container.innerHTML = "<p style='color:white; text-align:center;'>No products found.</p>";

                json.table.rows.forEach((row, index) => {
                    const title = row.c[0]?.v || "";
                    let price = row.c[1]?.v || "0";
                    const old = row.c[2]?.v || "";
                    const disc = row.c[3]?.v || "";
                    let imgStr = row.c[4]?.v || "";

                    if(title === "title" || price === "price") return;
                    
                    if(!imgStr) imgStr = "https://via.placeholder.com/300";
                    const images = imgStr.split(',').map(i => i.trim());
                    productImages[index] = images;

                    const safeTitle = title.replace(/'/g, "\\'");
                    const safeImg = images[0];
                    const t = translations[currentLang];

                    // Native Slider Construction
                    let slidesHtml = '';
                    let dotsHtml = '';
                    if (images.length > 0) {
                        slidesHtml = images.map((img, i) => `
                            <div class="slider-slide">
                                <img src="${img}" class="product-img" loading="lazy" onclick="openZoomImage('${img}')">
                            </div>
                        `).join('');
                        
                        if(images.length > 1) {
                            dotsHtml = `<div class="slider-dots" id="dots-${index}">
                                ${images.map((_, i) => `<div class="dot ${i===0?'active':''}"></div>`).join('')}
                            </div>`;
                        }
                    }

                    // Direct Form HTML
                    const directForm = `
                        <div class="direct-form">
                            <input type="text" id="d_name_${index}" class="direct-input" placeholder="${t.plh_name}">
                            <input type="tel" inputmode="numeric" id="d_phone_${index}" class="direct-input" placeholder="${t.plh_phone}*">
                            <div style="display:flex; gap:5px;">
                                <input type="text" id="d_city_${index}" class="direct-input" placeholder="${t.plh_city}">
                                <input type="text" id="d_size_${index}" class="direct-input" placeholder="${t.plh_size}">
                            </div>
                            <div class="action-row">
                                <button class="confirm-btn" onclick="submitDirectOrder(${index}, '${safeTitle}', '${price}')">
                                    ${t.send_order}
                                </button>
                                <button class="add-cart-btn" onclick="addToCart('${safeTitle}', '${price}', '${safeImg}')">
                                    <i class="fas fa-cart-plus"></i>
                                </button>
                            </div>
                        </div>
                    `;

                    const html = `
                        <div class="product-card">
                            <div class="slider-wrapper">
                                ${disc ? `<div class="discount-tag">${disc}</div>` : ''}
                                <div class="slider-container" id="slider-${index}" onscroll="updateDots(${index})">
                                    ${slidesHtml}
                                </div>
                                ${dotsHtml}
                            </div>
                            <div class="product-details">
                                <div class="product-title">${title}</div>
                                <div class="price-box">
                                    <span class="curr-price">${price} ${t.currency}</span>
                                    ${old ? `<span class="old-price">${old}</span>` : ''}
                                </div>
                                ${directForm}
                            </div>
                        </div>
                    `;
                    container.innerHTML += html;
                });

            } catch (e) {
                console.error(e);
                document.getElementById('products-container').innerHTML = "<p style='color:white; text-align:center'>Failed to load products.</p>";
            }
        }

        // --- Native Slider Dot Updater ---
        function updateDots(index) {
            const slider = document.getElementById(`slider-${index}`);
            const dots = document.querySelectorAll(`#dots-${index} .dot`);
            if(!slider || dots.length === 0) return;
            
            const scrollPos = slider.scrollLeft;
            const width = slider.offsetWidth;
            // Handle RTL/LTR scroll calculation logic
            const activeIndex = Math.round(Math.abs(scrollPos) / width);

            dots.forEach((dot, i) => {
                if(i === activeIndex) dot.classList.add('active');
                else dot.classList.remove('active');
            });
        }

        // --- Zoom ---
        function openZoomImage(src) {
            document.getElementById('zoomedImage').src = src;
            document.getElementById('zoomModal').style.display = 'flex';
        }
        function closeZoom() {
            document.getElementById('zoomModal').style.display = 'none';
        }

        // ============================================================
        // === SMART WHATSAPP LINK FUNCTION (THE FIX) ===
        // ============================================================
        function smartWhatsAppLink(phone, text) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø­Ù…ÙˆÙ„Ø§Ù‹
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            // ØªØ±Ù…ÙŠØ² Ø§Ù„Ù†Øµ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
            const encodedText = encodeURIComponent(text);
            
            if (isMobile) {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù‡Ø§ØªÙ Ù„ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ØªØµÙØ­
                window.location.href = `whatsapp://send?phone=${phone}&text=${encodedText}`;
            } else {
                // ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨
                window.open(`https://web.whatsapp.com/send?phone=${phone}&text=${encodedText}`, '_blank');
            }
        }

        // --- Orders ---
        function submitDirectOrder(index, title, price) {
            const t = translations[currentLang];
            const name = document.getElementById(`d_name_${index}`).value;
            const phone = document.getElementById(`d_phone_${index}`).value;
            const city = document.getElementById(`d_city_${index}`).value;
            const size = document.getElementById(`d_size_${index}`).value;

            if(!phone) { alert(currentLang === 'ar' ? "Ø§Ù„Ù…Ø±Ø¬Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" : "Enter phone number"); return; }

            const msg = `ğŸ‘‹ *${t.msg_hello}, ${t.msg_order_single}* \n\nğŸ“¦ *${t.msg_products}:* ${title}\nğŸ’° *${t.msg_total}:* ${price} ${t.currency}\n------------------\nğŸ‘¤ *${t.msg_customer}:* ${name}\nğŸ“ *${t.plh_phone}:* ${phone}\nğŸ“ *${t.plh_city}:* ${city}\nğŸ“ *${t.plh_size}:* ${size}`;
            
            if(typeof fbq !== 'undefined') fbq('track', 'Purchase', { content_name: title, value: parseFloat(price) || 0, currency: 'MAD' });
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† window.open Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
            smartWhatsAppLink(MY_PHONE, msg);
        }

        // --- Cart Logic ---
        let cart = JSON.parse(localStorage.getItem('myCart')) || [];
        updateCartBadge();

        function addToCart(title, price, img) {
            cart.push({ title, price, img });
            saveCart();
            const btn = event.currentTarget;
            btn.innerHTML = '<i class="fas fa-check" style="color:var(--success-color)"></i>';
            setTimeout(() => btn.innerHTML = '<i class="fas fa-cart-plus"></i>', 1500);
            if(typeof fbq !== 'undefined') fbq('track', 'AddToCart');
        }

        function saveCart() { 
            localStorage.setItem('myCart', JSON.stringify(cart)); 
            updateCartBadge(); 
        }

        function updateCartBadge() {
            const el = document.getElementById('cartBadge');
            el.innerText = cart.length;
            if(cart.length > 0) el.style.transform = "scale(1.2)";
            setTimeout(() => el.style.transform = "scale(1)", 200);
        }

        function openCart() {
            const list = document.getElementById('cartItemsList');
            const t = translations[currentLang];
            list.innerHTML = "";
            let total = 0;

            if(cart.length === 0) {
                list.innerHTML = `<p style="text-align:center; color:var(--text-sub); padding:20px;">${t.empty_cart}</p>`;
            } else {
                cart.forEach((item, i) => {
                    let p = parseFloat(item.price); if(isNaN(p)) p = 0; total += p;
                    list.innerHTML += `
                        <div class="cart-item">
                            <img src="${item.img}">
                            <div style="flex-grow:1">
                                <div style="font-weight:bold; font-size:13px; color:white">${item.title}</div>
                                <div style="font-size:12px; color:var(--text-sub)">${item.price} ${t.currency}</div>
                            </div>
                            <i class="fas fa-trash" style="color:#ef4444; padding:10px;" onclick="removeFromCart(${i})"></i>
                        </div>
                    `;
                });
            }
            document.getElementById('cartTotal').innerText = total;
            document.getElementById('cartModal').style.display = 'flex';
        }

        function removeFromCart(i) { cart.splice(i, 1); saveCart(); openCart(); }
        function closeCart() { document.getElementById('cartModal').style.display = 'none'; }

        function openCartOrderForm() {
            if(cart.length === 0) return;
            document.getElementById('cartModal').style.display = 'none';
            document.getElementById('cartOrderModal').style.display = 'flex';
            if(typeof fbq !== 'undefined') fbq('track', 'InitiateCheckout');
        }

        function submitCartOrder(e) {
            e.preventDefault();
            const t = translations[currentLang];
            const name = document.getElementById('c_name').value;
            const phone = document.getElementById('c_phone').value;
            const city = document.getElementById('c_city').value;
            const address = document.getElementById('c_address').value;
            const notes = document.getElementById('c_notes').value;

            let total = 0; 
            let pText = "";
            cart.forEach(c => { 
                let p = parseFloat(c.price); if(isNaN(p)) p=0; total+=p; 
                pText += `â–«ï¸ ${c.title} (${c.price})\n`; 
            });

            const msg = `ğŸ‘‹ *${t.msg_hello}, ${t.msg_order_cart}* \n\nğŸ›’ *${t.msg_products}:*\n${pText}\nğŸ’° *${t.msg_total}:* ${total} ${t.currency}\n------------------\nğŸ‘¤ *${t.msg_customer}:* ${name}\nğŸ“ *${t.plh_phone}:* ${phone}\nğŸ“ *${t.plh_city}:* ${city}\nğŸ  *${t.plh_city}:* ${address}\nğŸ“ ${notes}`;
            
            if(typeof fbq !== 'undefined') fbq('track', 'Purchase', { value: total, currency: 'MAD' });
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ù‡Ù†Ø§ Ø£ÙŠØ¶Ø§Ù‹
            smartWhatsAppLink(MY_PHONE, msg);
            
            cart = []; saveCart();
            document.getElementById('cartOrderModal').style.display = 'none';
        }
    </script>
</body>
</html>
